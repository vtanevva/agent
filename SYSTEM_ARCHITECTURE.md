# System Architecture Diagram - Productivity Assistant

## ğŸ—ï¸ Complete System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           EXTERNAL CLIENTS                                   â”‚
â”‚                  (Browser, Mobile App, API Clients)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ HTTP Requests
                              â”‚ (POST /api/chat, /api/gmail/*, etc.)
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FLASK APPLICATION                                    â”‚
â”‚                          (server.py)                                         â”‚
â”‚                         Port: 10000                                          â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      API LAYER (Blueprints)                         â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  ğŸ“¬ /api/chat                POST    General chat endpoint          â”‚    â”‚
â”‚  â”‚     â””â”€> chat_routes.py                                              â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  ğŸ“§ /api/gmail/*             13 endpoints                           â”‚    â”‚
â”‚  â”‚     â”œâ”€> /list                List emails                            â”‚    â”‚
â”‚  â”‚     â”œâ”€> /send                Send email                             â”‚    â”‚
â”‚  â”‚     â”œâ”€> /reply               Reply to email                         â”‚    â”‚
â”‚  â”‚     â”œâ”€> /thread              Get thread details                     â”‚    â”‚
â”‚  â”‚     â”œâ”€> /search              Search emails                          â”‚    â”‚
â”‚  â”‚     â”œâ”€> /classify            Classify email                         â”‚    â”‚
â”‚  â”‚     â”œâ”€> /triage              Triaged inbox                          â”‚    â”‚
â”‚  â”‚     â”œâ”€> /style               Analyze writing style                  â”‚    â”‚
â”‚  â”‚     â”œâ”€> /generate-reply      Generate reply draft                   â”‚    â”‚
â”‚  â”‚     â”œâ”€> /rewrite             Rewrite email                          â”‚    â”‚
â”‚  â”‚     â”œâ”€> /archive             Archive thread                         â”‚    â”‚
â”‚  â”‚     â”œâ”€> /mark-handled        Mark as handled                        â”‚    â”‚
â”‚  â”‚     â””â”€> /classify-bg         Background classification              â”‚    â”‚
â”‚  â”‚     â””â”€> gmail_routes.py                                             â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  ğŸ‘¤ /api/contacts/*          Contact management                     â”‚    â”‚
â”‚  â”‚     â””â”€> contacts_routes.py                                          â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  ğŸ” /google/*                OAuth endpoints                         â”‚    â”‚
â”‚  â”‚     â”œâ”€> /auth/<user_id>      Start OAuth flow                       â”‚    â”‚
â”‚  â”‚     â”œâ”€> /oauth2callback      OAuth callback                         â”‚    â”‚
â”‚  â”‚     â”œâ”€> /refresh/<user_id>   Refresh token                          â”‚    â”‚
â”‚  â”‚     â””â”€> /status/<user_id>    Check auth status                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ Validate & Extract
                               â”‚ (user_id, message, session_id, etc.)
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ORCHESTRATOR                                        â”‚
â”‚                    (app/agents/orchestrator.py)                              â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                      INTENT DETECTION                                 â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  User Message:  "Schedule meeting tomorrow at 3pm"                    â”‚  â”‚
â”‚  â”‚                               â”‚                                        â”‚  â”‚
â”‚  â”‚                   detect_intent(message)                              â”‚  â”‚
â”‚  â”‚                               â”‚                                        â”‚  â”‚
â”‚  â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚  â”‚
â”‚  â”‚          â”‚                    â”‚                    â”‚                  â”‚  â”‚
â”‚  â”‚     "calendar"           "email"            "general"                 â”‚  â”‚
â”‚  â”‚    (keywords: schedule, (keywords: email,   (default)                â”‚  â”‚
â”‚  â”‚     meeting, event)      inbox, reply)                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                              â”‚
â”‚                    Route to Domain Agent                                     â”‚
â”‚                               â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚            â”‚                â”‚             â”‚              â”‚             â”‚
â”‚  â”‚ AivisCore  â”‚   Calendar     â”‚   Gmail     â”‚  Contacts    â”‚             â”‚
â”‚  â”‚   Agent    â”‚    Agent       â”‚   Agent     â”‚   Agent      â”‚             â”‚
â”‚  â”‚            â”‚                â”‚             â”‚              â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ Agent Handles Request
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         AGENT LAYER                                          â”‚
â”‚                    (app/agents/*.py)                                         â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ğŸ¤– AIVIS CORE AGENT                                                â”‚    â”‚
â”‚  â”‚     (General Productivity & Chat)                                   â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚     â€¢ General conversation                                           â”‚    â”‚
â”‚  â”‚     â€¢ Task planning & organization                                   â”‚    â”‚
â”‚  â”‚     â€¢ Text rewriting & summarization                                 â”‚    â”‚
â”‚  â”‚     â€¢ Memory retrieval (facts, context)                              â”‚    â”‚
â”‚  â”‚     â€¢ Productivity advice                                            â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚     Uses: LLMService + MemoryService                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ğŸ“… CALENDAR AGENT                                                   â”‚    â”‚
â”‚  â”‚     (Scheduling & Events)                                            â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚     â€¢ Natural language date/time parsing                             â”‚    â”‚
â”‚  â”‚       "tomorrow at 3pm" â†’ 2025-12-29T15:00:00                        â”‚    â”‚
â”‚  â”‚     â€¢ Create calendar events                                         â”‚    â”‚
â”‚  â”‚     â€¢ List upcoming events                                           â”‚    â”‚
â”‚  â”‚     â€¢ Manage schedules                                               â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚     Uses: LLMService + calendar_manager tools                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ğŸ“§ GMAIL AGENT                                                      â”‚    â”‚
â”‚  â”‚     (Email Management)                                               â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚     â€¢ List & search emails                                           â”‚    â”‚
â”‚  â”‚     â€¢ Read & classify emails                                         â”‚    â”‚
â”‚  â”‚       (important, action_needed, informational, spam)                â”‚    â”‚
â”‚  â”‚     â€¢ Send & reply to emails                                         â”‚    â”‚
â”‚  â”‚     â€¢ Writing style analysis                                         â”‚    â”‚
â”‚  â”‚     â€¢ Draft generation in user's style                               â”‚    â”‚
â”‚  â”‚     â€¢ Email rewriting & polish                                       â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚     Uses: LLMService + GmailService + Gmail tools                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ğŸ‘¤ CONTACTS AGENT                                                   â”‚    â”‚
â”‚  â”‚     (Contact Management)                                             â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚     â€¢ Sync contacts from Gmail Sent                                  â”‚    â”‚
â”‚  â”‚     â€¢ List & search contacts                                         â”‚    â”‚
â”‚  â”‚     â€¢ Contact grouping (by person/company/category)                  â”‚    â”‚
â”‚  â”‚     â€¢ Update contact info (name, nickname, groups)                   â”‚    â”‚
â”‚  â”‚     â€¢ Contact detail & interaction history                           â”‚    â”‚
â”‚  â”‚     â€¢ Past conversation retrieval                                    â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚     Uses: ContactsService + LLMService                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ Call Services
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SERVICES LAYER                                       â”‚
â”‚                    (app/services/*.py)                                       â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  ğŸ§  LLMService (llm_service.py)                                   â”‚      â”‚
â”‚  â”‚     OpenAI API wrapper                                            â”‚      â”‚
â”‚  â”‚                                                                    â”‚      â”‚
â”‚  â”‚     â€¢ chat_completion() - Chat with GPT models                    â”‚      â”‚
â”‚  â”‚     â€¢ chat_completion_text() - Get text response                  â”‚      â”‚
â”‚  â”‚     â€¢ generate_embedding() - Create embeddings                    â”‚      â”‚
â”‚  â”‚     â€¢ generate_embeddings_batch() - Batch embeddings              â”‚      â”‚
â”‚  â”‚                                                                    â”‚      â”‚
â”‚  â”‚     Model: gpt-4o-mini (configurable)                             â”‚      â”‚
â”‚  â”‚     Temperature: 0.3 | Max tokens: 768                            â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                               â”‚                                              â”‚
â”‚                               â–¼                                              â”‚
â”‚                         OpenAI API                                           â”‚
â”‚                   (chat.completions, embeddings)                             â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  ğŸ’¾ MemoryService (memory_service.py)                             â”‚      â”‚
â”‚  â”‚     Conversation & Facts Storage                                  â”‚      â”‚
â”‚  â”‚                                                                    â”‚      â”‚
â”‚  â”‚     MongoDB Operations:                                           â”‚      â”‚
â”‚  â”‚     â€¢ save_message() - Store chat messages                        â”‚      â”‚
â”‚  â”‚     â€¢ get_session_memory() - Retrieve conversation history        â”‚      â”‚
â”‚  â”‚                                                                    â”‚      â”‚
â”‚  â”‚     Pinecone Operations (Optional):                               â”‚      â”‚
â”‚  â”‚     â€¢ save_fact() - Store user facts as vectors                   â”‚      â”‚
â”‚  â”‚     â€¢ retrieve_facts() - Semantic search facts                    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                               â”‚                                              â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚                     â–¼                   â–¼                                    â”‚
â”‚               MongoDB              Pinecone                                  â”‚
â”‚          (conversations,            (vector facts)                           â”‚
â”‚           contacts, tokens)                                                  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  ğŸ“§ GmailService (gmail_service.py)                               â”‚      â”‚
â”‚  â”‚     Gmail API Operations                                          â”‚      â”‚
â”‚  â”‚                                                                    â”‚      â”‚
â”‚  â”‚     â€¢ get_thread_detail() - Get email thread                      â”‚      â”‚
â”‚  â”‚     â€¢ reply_to_thread() - Send reply                              â”‚      â”‚
â”‚  â”‚     â€¢ list_threads() - List emails                                â”‚      â”‚
â”‚  â”‚     â€¢ search_threads() - Search emails                            â”‚      â”‚
â”‚  â”‚     â€¢ classify_single_email() - Classify importance               â”‚      â”‚
â”‚  â”‚     â€¢ analyze_email_style() - Analyze writing style               â”‚      â”‚
â”‚  â”‚     â€¢ generate_reply_draft() - Draft in user's style              â”‚      â”‚
â”‚  â”‚     â€¢ rewrite_email_text() - Rewrite & polish                     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                               â”‚                                              â”‚
â”‚                               â–¼                                              â”‚
â”‚                          Gmail API                                           â”‚
â”‚                    (messages, threads, send)                                 â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  ğŸ‘¤ ContactsService (contacts_service.py)                         â”‚      â”‚
â”‚  â”‚     Contact Management                                            â”‚      â”‚
â”‚  â”‚                                                                    â”‚      â”‚
â”‚  â”‚     â€¢ sync_contacts() - Import from Gmail                         â”‚      â”‚
â”‚  â”‚     â€¢ list_contacts() - List all contacts                         â”‚      â”‚
â”‚  â”‚     â€¢ get_contact_detail() - Get contact info                     â”‚      â”‚
â”‚  â”‚     â€¢ update_contact() - Update contact                           â”‚      â”‚
â”‚  â”‚     â€¢ list_contact_groups() - List groups                         â”‚      â”‚
â”‚  â”‚     â€¢ get_contact_conversations() - Chat history                  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                               â”‚                                              â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚                     â–¼                   â–¼                                    â”‚
â”‚               MongoDB              Gmail API                                 â”‚
â”‚            (contacts DB)          (sent messages)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ OAuth & API Clients
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      UTILITY LAYER                                           â”‚
â”‚                    (app/utils/*.py)                                          â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  ğŸ”§ google_api_helpers.py                                         â”‚      â”‚
â”‚  â”‚                                                                    â”‚      â”‚
â”‚  â”‚     â€¢ get_gmail_service(user_id)                                  â”‚      â”‚
â”‚  â”‚       â””â”€> Loads OAuth â†’ Builds Gmail API client                  â”‚      â”‚
â”‚  â”‚                                                                    â”‚      â”‚
â”‚  â”‚     â€¢ get_calendar_service(user_id)                               â”‚      â”‚
â”‚  â”‚       â””â”€> Loads OAuth â†’ Builds Calendar API client               â”‚      â”‚
â”‚  â”‚                                                                    â”‚      â”‚
â”‚  â”‚     â€¢ get_instagram_auth(user_id)                                 â”‚      â”‚
â”‚  â”‚       â””â”€> Returns Instagram access token                          â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  ğŸ“Š logging_utils.py                                              â”‚      â”‚
â”‚  â”‚                                                                    â”‚      â”‚
â”‚  â”‚     â€¢ get_logger(__name__) - Module-specific logger               â”‚      â”‚
â”‚  â”‚     â€¢ configure_logging() - Setup log format & level              â”‚      â”‚
â”‚  â”‚     â€¢ Colored output in dev, structured in prod                   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  ğŸ” oauth_utils.py                                                â”‚      â”‚
â”‚  â”‚                                                                    â”‚      â”‚
â”‚  â”‚     â€¢ load_google_credentials(user_id)                            â”‚      â”‚
â”‚  â”‚     â€¢ save_google_credentials(user_id, creds)                     â”‚      â”‚
â”‚  â”‚     â€¢ require_google_auth() - Decorator for protected routes      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATABASE LAYER                                          â”‚
â”‚                    (app/db/collections.py)                                   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  MongoDB Collection Getters                                       â”‚      â”‚
â”‚  â”‚                                                                    â”‚      â”‚
â”‚  â”‚     â€¢ get_conversations_collection()                              â”‚      â”‚
â”‚  â”‚     â€¢ get_contacts_collection()                                   â”‚      â”‚
â”‚  â”‚     â€¢ get_tokens_collection() (OAuth)                             â”‚      â”‚
â”‚  â”‚     â€¢ get_calendar_events_collection()                            â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         EXTERNAL SYSTEMS                                     â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  OpenAI    â”‚  â”‚  MongoDB   â”‚  â”‚  Google    â”‚  â”‚  Pinecone  â”‚          â”‚
â”‚  â”‚    API     â”‚  â”‚            â”‚  â”‚   APIs     â”‚  â”‚            â”‚          â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚
â”‚  â”‚â€¢ GPT-4o    â”‚  â”‚â€¢ Convs     â”‚  â”‚â€¢ Gmail     â”‚  â”‚â€¢ Vector    â”‚          â”‚
â”‚  â”‚â€¢ Embedding â”‚  â”‚â€¢ Contacts  â”‚  â”‚â€¢ Calendar  â”‚  â”‚  Facts     â”‚          â”‚
â”‚  â”‚            â”‚  â”‚â€¢ Tokens    â”‚  â”‚â€¢ OAuth2    â”‚  â”‚            â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Example: Complete Request Flow

### Scenario: User asks to schedule a meeting

```
1. HTTP REQUEST
   POST /api/chat
   {
     "user_id": "user123",
     "message": "Schedule a meeting with John tomorrow at 3pm",
     "session_id": "session456"
   }

2. API LAYER (chat_routes.py)
   â€¢ Validates request
   â€¢ Extracts: user_id, message, session_id
   â€¢ Calls: orchestrator.handle_chat()

3. ORCHESTRATOR (orchestrator.py)
   â€¢ detect_intent("Schedule a meeting...")
   â€¢ Keywords detected: "schedule", "meeting"
   â€¢ Intent: "calendar"
   â€¢ Routes to: CalendarAgent

4. CALENDAR AGENT (calendar_agent.py)
   â€¢ handle_chat(user_id, message)
   â€¢ Calls: detect_calendar_requests(message)
   â€¢ Extracts: "meeting with John tomorrow at 3pm"
   â€¢ Parses: parse_datetime_from_text()
     â””â”€> start: 2025-12-29T15:00:00
     â””â”€> end: 2025-12-29T16:00:00

5. CALENDAR TOOLS (calendar_manager.py)
   â€¢ create_calendar_event(
       user_id="user123",
       summary="Meeting with John",
       start_time="2025-12-29T15:00:00",
       end_time="2025-12-29T16:00:00"
     )

6. GOOGLE API HELPER (google_api_helpers.py)
   â€¢ get_calendar_service(user_id)
   â€¢ Loads OAuth credentials from MongoDB
   â€¢ Builds Google Calendar API client

7. GOOGLE CALENDAR API
   â€¢ Creates event on user's calendar
   â€¢ Returns: event ID + confirmation

8. RESPONSE CHAIN (back up)
   Calendar Agent
     â””â”€> "âœ… I've scheduled 'Meeting with John' for December 29 at 3:00 PM"
   Orchestrator
     â””â”€> Returns: { "reply": "âœ… ...", "intent": "calendar" }
   API Layer
     â””â”€> HTTP 200: { "reply": "âœ… ..." }
   Client
     â””â”€> Displays success message

Total latency: ~2-3 seconds
```

---

## ğŸ”„ Data Flow Patterns

### Pattern 1: Chat with Memory
```
User Message
    â†“
Orchestrator â†’ Intent: "general"
    â†“
AivisCoreAgent
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Get Memory   â”‚ â† MemoryService â†’ MongoDB
â”‚ 2. Build Contextâ”‚   (last 20 messages)
â”‚ 3. Call LLM     â”‚ â† LLMService â†’ OpenAI
â”‚ 4. Save Reply   â”‚ â† MemoryService â†’ MongoDB
â”‚ 5. Save Facts   â”‚ â† MemoryService â†’ Pinecone
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Response
```

### Pattern 2: Email with Style Analysis
```
User: "Generate reply to thread XYZ"
    â†“
Orchestrator â†’ Intent: "email"
    â†“
GmailAgent
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Get thread detail â”‚ â† GmailService â†’ Gmail API
â”‚ 2. Analyze style     â”‚ â† gmail_style tools
â”‚    â€¢ Fetch 10 sent   â”‚   (analyze user's writing)
â”‚    â€¢ Extract patternsâ”‚
â”‚ 3. Generate draft    â”‚ â† LLMService â†’ OpenAI
â”‚    with user's style â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Response: Draft email in user's style
```

### Pattern 3: Contact Sync
```
User: "Sync my contacts"
    â†“
Orchestrator â†’ Intent: "general" â†’ ContactsAgent
    â†“
ContactsAgent.sync()
    â†“
ContactsService
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Fetch Gmail Sent    â”‚ â† Gmail API (1000 messages)
â”‚ 2. Extract recipients  â”‚
â”‚ 3. Parse names/emails  â”‚
â”‚ 4. Group by person     â”‚   (John@work.com, John@home.com)
â”‚ 5. Group by company    â”‚   (Company A employees)
â”‚ 6. Categorize          â”‚   (travel, food, events)
â”‚ 7. Generate nicknames  â”‚   ("John - Acme Corp")
â”‚ 8. Upsert to MongoDB   â”‚ â† MongoDB
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Response: Synced 247 contacts
```

---

## ğŸ¯ Key Design Principles

1. **Separation of Concerns**
   - API: Routing & validation
   - Orchestrator: Intent detection
   - Agents: Business logic
   - Services: External APIs
   - Utils: Pure helpers

2. **Dependency Injection**
   - Services injected into agents
   - Testable and modular

3. **Single Responsibility**
   - Each component has one clear purpose
   - Easy to understand and maintain

4. **Centralized Configuration**
   - All settings in `config.py`
   - Environment-specific behavior

5. **Unified Logging**
   - Consistent format across modules
   - Easy debugging and monitoring

---

## âœ¨ Architecture Benefits

âœ… **Scalable** - Easy to add new agents/services
âœ… **Maintainable** - Clear structure and separation
âœ… **Testable** - Dependency injection enables unit tests
âœ… **Observable** - Unified logging throughout
âœ… **Flexible** - Services can be swapped/mocked
âœ… **Production-Ready** - Proper error handling & validation

